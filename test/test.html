<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>simple table sort - a jQuery plugin â€” Test</title>

  <link href="resources/qunit-1.10.0.css" rel="stylesheet">

  <script src="resources/qunit-1.10.0.js"></script>
  <script src="../lib/jquery.js"></script>
  <script src="../jquery.simpleTableSort.js"></script>
  <script src="resources/prerequisites.js"></script>

  <script>
  $(function() {
    var table, i;

    var testColumns = {
      alphabetical: 'Name',
      numeric: 'Age',
      float: 'Height (in m)',
      date: 'Reg. date'
    };

    var testRows = [
      ['Felix', '37', '1.68', 'Jan 28, 2006'],
      ['Anton', '77', '1.86', 'Dec 30, 2011'],
      ['Laith', '79', '1.74', 'Jul 17, 2008'],
      ['Zaphod', '39', '1.59', 'Jun 23, 2008'],
      ['Dorian', '28', '2.12', 'Oct 6, 2012']
    ];

    module('Built-in sort methods', {
      setup: function() {
        table = createTestTable(testColumns, testRows).simpleTableSort({ order: 'asc' });
      },
      teardown: function() {
        table.remove();
      }
    });

    // pre-sorted values
    var expectedData = {
      alphabetic: ['Anton', 'Dorian', 'Felix', 'Laith', 'Zaphod'],
      numeric: ['28', '37', '39', '77', '79'],
      float: ['1.59', '1.68', '1.74', '1.86', '2.12'],
      date: ['Jan 28, 2006', 'Jun 23, 2008', 'Jul 17, 2008', 'Dec 30, 2011', 'Oct 6, 2012']
    };

    // check ascending
    function testAscending(sortMethod, expected, index) {
      test('sort ascending: '+sortMethod, function() {
        table.find('th').eq(index).trigger('click');

        var actual = [];
        table.find('tbody tr').each(function(a) {
          actual.push($('td', this).eq(index).text());
        });

        deepEqual(actual, expected, 'Wrong sorting order');
      });
    }
    // end check ascending

    // check descending
    function testDescending(sortMethod, expected, index) {
      console.log(this);
      test('sort descending: '+sortMethod, function() {
        table.find('th').eq(index).trigger('click').trigger('click');

        var actual = [];
        table.find('tbody tr').each(function(a) {
          actual.push($('td', this).eq(index).text());
        });

        expected.reverse();
        deepEqual(actual, expected, 'Wrong sorting order');
      });
    }
    // end check descending

    i = 0;
    $.each(expectedData, function(sortMethod, expected) {
      testAscending(sortMethod, expected, i++);
    });

    i = 0;
    $.each(expectedData, function(sortMethod, expected) {
      testDescending(sortMethod, expected, i++);
    });

    module('Options');

    test('Change prefix', function() {
      var before, after;
      table = createTestTable(testColumns, testRows, 'sortable').simpleTableSort({ prefix: 'sortable' });

      before = table.find('tbody td').eq(0).text();
      table.find('th').eq(0).trigger('click');
      after = table.find('tbody td').eq(0).text();

      notEqual(after, before, 'Sort order has not changed');

      var classList = table.find('th').eq(0).prop('class').split(' ');
      var result = true;
      $.each(classList, function(i, className) {
        if (!/sortable-/.test(className)) {
          result = false;
          return false;
        }
      });

      ok(result, 'Class prefix was not changed');

      table.remove();
    });

    test('Excluded rows', function() {
      var before = '', after = '';
      table = createTestTable(testColumns, testRows).simpleTableSort({ excludeSortColumns: [1, 2, -1] });

      before = table.find('tbody td').eq(1).text();
      table.find('th').eq(1).trigger('click');
      after = table.find('tbody td').eq(1).text();
      equal(after, before, 'Sort order has changed, although it was excluded');

      before = table.find('tbody td').eq(2).text();
      table.find('th').eq(2).trigger('click');
      after = table.find('tbody td').eq(2).text();
      equal(after, before, 'Sort order has changed, although it was excluded');

      before = table.find('tbody td').eq(3).text();
      table.find('th').eq(3).trigger('click');
      after = table.find('tbody td').eq(3).text();
      equal(after, before, 'Sort order has changed, although it was excluded');

      table.remove();
    });
  });
  </script>
</head>
<body>
  <div id="qunit"></div>
</body>
</html>